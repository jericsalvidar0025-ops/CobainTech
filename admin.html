<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin Dashboard — CobainTech</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
/* ---------------- Global ---------------- */
body { margin:0; font-family:'Inter',sans-serif; background:#0b0c0e; color:#eee; }
a { color:inherit; text-decoration:none; }
h1,h2,h3,h4,h5,h6 { margin:0; }
button { cursor:pointer; transition:0.2s; }

/* ---------------- Header ---------------- */
header { background:#111; padding:12px 24px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 6px rgba(0,0,0,0.5);}
header .brand { font-weight:700; font-size:1.5rem; color:#fff; }
.header-actions button { background:#3498db; border:none; color:#fff; padding:8px 16px; border-radius:6px; font-weight:600; }
.header-actions button:hover { background:#2980b9; }

/* ---------------- Layout ---------------- */
.container { display:flex; height:calc(100vh - 60px); }
nav.sidebar { width:220px; background:#111; padding:16px; display:flex; flex-direction:column; box-shadow:2px 0 6px rgba(0,0,0,0.5); }
nav.sidebar button { background:none; border:none; color:#eee; text-align:left; padding:12px; margin-bottom:8px; border-radius:6px; font-size:1rem; font-weight:600; }
nav.sidebar button.active, nav.sidebar button:hover { background:#3498db; color:#fff; }
main.content { flex:1; padding:24px; overflow-y:auto; }

/* ---------------- Cards & Tables ---------------- */
.card { background:#111; padding:16px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.5); margin-bottom:24px; }
table { width:100%; border-collapse:collapse; margin-top:12px; }
th, td { padding:12px; text-align:left; }
th { background:#222; font-weight:600; }
tr:nth-child(even) { background:#1a1a1a; }
tr:hover { background:#2c3e50; }
button.small { padding:6px 12px; border-radius:6px; font-size:.85rem; }

/* ---------------- Inputs ---------------- */
input, select { background:#1a1a1a; color:#eee; border:1px solid #444; border-radius:6px; padding:6px 10px; width:100%; margin-bottom:12px; }
label { display:block; margin-bottom:6px; font-weight:600; }

/* ---------------- Modals ---------------- */
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000; }
.modal-inner { background:#111; padding:24px; border-radius:12px; max-width:600px; width:90%; box-shadow:0 6px 20px rgba(0,0,0,0.5); position:relative; }
.modal-inner button.close { position:absolute; top:16px; right:16px; background:#e74c3c; color:#fff; border:none; padding:6px 12px; border-radius:6px; font-weight:600; cursor:pointer; }

/* ---------------- Products Grid ---------------- */
.product-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:16px; margin-top:16px; }
.product-card { background:#1a1a1a; border-radius:12px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.5); display:flex; flex-direction:column; transition:0.2s; }
.product-card:hover { transform:translateY(-4px); }
.product-card img { width:100%; height:150px; object-fit:cover; }
.product-card .product-info { padding:12px; flex:1; display:flex; flex-direction:column; }
.product-card h4 { margin-bottom:8px; font-size:1rem; font-weight:700; }
.product-card p { font-size:.9rem; margin-bottom:4px; color:#bbb; }
.product-card .actions { margin-top:auto; display:flex; gap:6px; }

/* ---------------- Orders Status ---------------- */
.status { padding:.2rem .6rem; border-radius:6px; font-weight:600; color:#fff; display:inline-block; font-size:.85rem; }
.Pending { background:orange; }
.Processing { background:#3498db; }
.Shipped { background:purple; }
.Delivered { background:green; }

/* ---------------- Sales ---------------- */
.sales-metrics { display:flex; gap:16px; margin-bottom:24px; flex-wrap:wrap; }
.metric { flex:1; min-width:150px; background:#111; padding:16px; border-radius:12px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.5); }
.metric h3 { font-size:1.2rem; margin-bottom:8px; }
.metric p { font-size:1.5rem; font-weight:bold; color:#3498db; }
</style>
</head>
<body>

<header>
  <div class="brand">CobainTech Admin</div>
  <div class="header-actions">
    <span id="welcome-user-top"></span>
    <button onclick="logoutUser()">Logout</button>
  </div>
</header>

<div class="container">
  <nav class="sidebar">
    <button class="active" onclick="showTab('products')">Products</button>
    <button onclick="showTab('orders')">Orders</button>
    <button onclick="showTab('sales')">Sales</button>
  </nav>

  <main class="content">
    <!-- Products Tab -->
    <section id="tab-products">
      <div class="card">
        <button class="btn primary" onclick="showAddProduct()">Add Product</button>
        <div id="product-form-area">
          <h3 id="product-form-title">Add Product</h3>
          <form id="product-form" onsubmit="saveProduct(event)">
            <input type="hidden" id="p-id">
            <label>Title <input id="p-title" required></label>
            <label>Price <input type="number" id="p-price" required></label>
            <label>Stock <input type="number" id="p-stock" required></label>
            <label>Category <input id="p-category" required></label>
            <label>Description <input id="p-desc"></label>
            <label>Image URL <input id="p-image-url" placeholder="https://example.com/image.jpg"></label>
            <img id="p-image-preview" src="" style="width:150px;height:150px;object-fit:cover;margin-top:10px;border-radius:8px;">
            <div style="display:flex;gap:8px;margin-top:8px;">
              <button type="submit" class="btn primary">Save</button>
              <button type="button" class="btn ghost" onclick="hideProductForm()">Cancel</button>
            </div>
          </form>
        </div>
      </div>
      <input id="admin-search" placeholder="Search products..." oninput="renderAdminProducts()">
      <div id="admin-product-list" class="product-grid"></div>
    </section>

    <!-- Orders Tab -->
    <section id="tab-orders" style="display:none">
      <div class="card">
        <h3>Orders</h3>
        <table>
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Items</th>
              <th>Total</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="admin-orders"></tbody>
        </table>
      </div>
    </section>

    <!-- Sales Tab -->
    <section id="tab-sales" style="display:none">
      <div class="card">
        <h3>Sales Overview</h3>
        <div class="sales-metrics">
          <div class="metric">
            <h3>Total Revenue</h3>
            <p id="total-revenue">₱0</p>
          </div>
          <div class="metric">
            <h3>Total Orders</h3>
            <p id="total-orders">0</p>
          </div>
        </div>
        <canvas id="salesChart" height="250"></canvas>
      </div>
    </section>
  </main>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>
<script src="script.js"></script>

<script>
// Tabs
function showTab(tab){
  ['products','orders','sales'].forEach(t=>{
    document.getElementById('tab-'+t).style.display=(t===tab)?'block':'none';
    document.querySelectorAll('.sidebar button').forEach(btn=>{
      btn.classList.toggle('active', btn.textContent.toLowerCase()===t);
    });
  });
}

// Image preview
const imgInput=document.getElementById('p-image-url');
const imgPreview=document.getElementById('p-image-preview');
if(imgInput) imgInput.addEventListener('input',()=>{imgPreview.src=imgInput.value||'https://via.placeholder.com/150';});

// Admin Dashboard
window.addEventListener('load',()=>{
  bindAuthState();
  initAdmin();
  initAdminOrders();
  renderAdminProducts();
  renderSalesChart();

  // Sales metrics
  ordersRef().onSnapshot(snapshot=>{
    let totalRevenue=0;
    snapshot.forEach(doc=>{ totalRevenue+=doc.data().total||0; });
    document.getElementById('total-revenue').textContent='₱'+totalRevenue.toLocaleString();
    document.getElementById('total-orders').textContent=snapshot.size;
  });
});
</script>

</body>
</html>
