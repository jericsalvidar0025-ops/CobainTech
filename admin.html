<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin Dashboard ‚Äî CobainTech</title>
<link rel="stylesheet" href="style.css">

<style>
/* ---------------- Global ---------------- */
body { margin:0; font-family:'Segoe UI',Roboto,sans-serif; background:#0b0c0e; color:#eee; }
a { color:inherit; text-decoration:none; }
h1,h2,h3,h4,h5,h6 { margin:0; }
button { cursor:pointer; }

/* ---------------- Header ---------------- */
header {
  background:#111;
  padding:12px 24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 2px 6px rgba(0,0,0,0.5);
}
.brand { font-weight:bold; font-size:1.5rem; color:#fff; }
.header-actions button {
  background:#3498db;
  border:none;
  color:#fff;
  padding:8px 16px;
  border-radius:6px;
  transition:0.2s;
}
.header-actions button:hover { background:#2980b9; }

/* ---------------- Layout ---------------- */
.container { display:flex; height:calc(100vh - 60px); }
nav.sidebar {
  width:220px;
  background:#111;
  padding:16px;
  display:flex;
  flex-direction:column;
  box-shadow:2px 0 6px rgba(0,0,0,0.5);
}
nav.sidebar button {
  background:none;
  border:none;
  color:#eee;
  text-align:left;
  padding:12px;
  margin-bottom:8px;
  border-radius:6px;
  font-size:1rem;
  transition:0.2s;
}
nav.sidebar button.active,
nav.sidebar button:hover {
  background:#3498db;
  color:#fff;
}
main.content { flex:1; padding:24px; overflow-y:auto; }

/* ---------------- Cards ---------------- */
.card {
  background:#111;
  padding:16px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.5);
  margin-bottom:24px;
}

/* ---------------- Admin Chat ---------------- */
.user-btn {
  display:flex;
  gap:10px;
  align-items:center;
  padding:10px;
  background:#111;
  border-radius:8px;
  border:1px solid #1b1b1b;
  color:#eee;
  cursor:pointer;
}
.user-btn:hover { background:#17202a; transform:translateY(-1px); }

.user-avatar {
  width:44px;height:44px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-weight:700;color:#fff;background:#3498db;
}

.user-meta { display:flex; flex-direction:column; min-width:0; }
.user-name { font-weight:700; color:#fff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:170px; }
.user-last { font-size:0.85rem; color:#9b9b9b; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:170px; }
.user-badge { margin-left:auto; background:#e74c3c; color:#fff; font-size:0.8rem; padding:4px 8px; border-radius:999px; }

.bubble-admin { align-self:flex-end; background:#3498db; color:#fff; padding:8px 12px; border-radius:12px; max-width:75%; }
.bubble-customer { align-self:flex-start; background:#1f2226; color:#fff; padding:8px 12px; border-radius:12px; max-width:75%; }
.msg-time { font-size:0.75rem; color:#9b9b9b; margin-top:4px; align-self:flex-end; }

/* ---------------- Call Overlay ---------------- */
#call-panel {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.75);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:2000;
}
#call-panel-inner {
  background:#111;
  padding:25px;
  border-radius:12px;
  text-align:center;
  max-width:380px;
}
</style>
</head>
<body>

<header>
  <div class="brand">CobainTech Admin</div>
  <div class="header-actions" style="display:flex;align-items:center;gap:10px;">
    <span id="welcome-user-top"></span>
    <button onclick="window.open('index.html','_blank')">üè¨ Store</button>
    <button onclick="logoutUser()" style="background:#e74c3c;">Logout</button>
  </div>
</header>

<!-- LOGOUT FIX -->
<script>
window.addEventListener('load', () => {
  window.logoutUser = function () {
    firebase.auth().signOut().then(() => {
      window.location.href = "index.html";
    });
  };
});
</script>

<div class="container">
  <nav class="sidebar">
    <button class="active" onclick="showTab('products')">Products</button>
    <button onclick="showTab('orders')">Orders</button>
    <button onclick="showTab('sales')">Sales</button>
    <button onclick="showTab('settings')">Settings</button>
    <button onclick="showTab('chat')">Chat</button>
  </nav>

  <main class="content">

    <!-- ---------------- PRODUCTS ---------------- -->
    <section id="tab-products">
      <div class="card">
        <button onclick="showAddProduct()" class="btn primary">Add Product</button>

        <div id="product-form-area" style="display:none;">
          <h3 id="product-form-title">Add Product</h3>

          <form id="product-form" onsubmit="saveProduct(event)">
            <input type="hidden" id="p-id">

            <label>Title <input id="p-title" required></label>
            <label>Price <input type="number" id="p-price" required></label>
            <label>Stock <input type="number" id="p-stock" required></label>
            <label>Category <input id="p-category" required></label>
            <label>Description <input id="p-desc"></label>
            <label>Image URL <input id="p-image-url"></label>

            <div style="display:flex;gap:8px;">
              <button type="submit" class="btn primary">Save</button>
              <button type="button" onclick="hideProductForm()">Cancel</button>
            </div>
          </form>
        </div>
      </div>

      <input id="admin-search" placeholder="Search products..." oninput="renderAdminProducts()">
      <div id="admin-product-list" class="product-grid"></div>
    </section>

    <!-- ---------------- CHAT TAB ---------------- -->
    <section id="tab-chat" style="display:none;">
      <div class="card" style="padding:14px; height:600px; display:flex; flex-direction:column;">

        <div style="display:flex; justify-content:space-between; align-items:center;">
          <h3>Customer Messages</h3>
          <input id="chat-search" placeholder="Search..." style="padding:8px">
        </div>

        <div style="display:flex; flex:1; gap:12px; margin-top:10px;">

          <!-- LEFT SIDE (users) -->
          <div id="chat-users" style="width:300px; overflow:auto; background:#0f1113; padding:10px; border-radius:8px;">
            <div style="color:#999;">Loading users‚Ä¶</div>
          </div>

          <!-- RIGHT SIDE (messages + input) -->
          <div style="flex:1; display:flex; flex-direction:column;">

            <div id="chat-panel-header"
                 style="background:#0f1113;padding:12px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;">
              <div style="display:flex;gap:10px;align-items:center;">
                <div id="chat-avatar"
                     style="width:48px;height:48px;border-radius:50%;background:#3498db;display:flex;align-items:center;justify-content:center;font-weight:bold;">
                  U
                </div>
                <div>
                  <div id="chat-with" style="font-weight:bold;">Select a customer</div>
                  <div id="chat-last-seen" style="font-size:0.8rem;color:#aaa;">‚Äî</div>
                </div>
              </div>

              <div>
                <button id="btn-call" onclick="startCallAsAdmin()" class="btn small">üìû Call</button>
                <button id="btn-hangup" onclick="hangupCall()" class="btn small" style="background:#e74c3c;display:none;">Hang up</button>
              </div>
            </div>

            <div id="chat-admin-messages"
                 style="flex:1; background:#070708; border-radius:8px; padding:12px; overflow:auto; margin-top:10px; display:flex; flex-direction:column;">
              <div style="color:#777;">Open a conversation.</div>
            </div>

            <div id="chat-typing" style="color:#aaa; height:18px; margin-top:4px;"></div>

            <div style="display:flex; gap:8px;">
              <input id="admin-chat-input" placeholder="Type a message..." style="flex:1; padding:10px;">
              <button onclick="adminSendChat()" class="btn primary">Send</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ---------------- ORDERS ---------------- -->
    <section id="tab-orders" style="display:none;">
      <div class="card">
        <h3>Orders</h3>
        <table>
          <thead>
            <tr><th>Order ID</th><th>Customer</th><th>Items</th><th>Total</th><th>Status</th><th>Actions</th></tr>
          </thead>
          <tbody id="admin-orders"></tbody>
        </table>
      </div>
    </section>

    <!-- ---------------- SALES ---------------- -->
    <section id="tab-sales" style="display:none;">
      <div class="card">
        <h3>Sales Overview</h3>
        <div class="sales-metrics">
          <div class="metric"><h3>Total Revenue</h3><p id="total-revenue">‚Ç±0</p></div>
          <div class="metric"><h3>Total Orders</h3><p id="total-orders">0</p></div>
        </div>
        <canvas id="salesChart"></canvas>
      </div>
    </section>

    <!-- ---------------- SETTINGS ---------------- -->
    <section id="tab-settings" style="display:none;">
      <div class="card">
        <h3>Store Settings</h3>
        <form id="settings-form" onsubmit="saveSettings(event)">
          <label>Store Name <input id="store-name"></label>
          <label>Store Logo URL <input id="store-logo"></label>
          <label>Contact Email <input id="store-email"></label>
          <label>Contact Phone <input id="store-phone"></label>
          <button type="submit" class="btn primary">Save</button>
        </form>
      </div>
    </section>

  </main>
</div>

<!-- ---------------- CALL OVERLAY ---------------- -->
<div id="call-panel">
  <div id="call-panel-inner">
    <h3 id="call-status">Calling‚Ä¶</h3>
    <button onclick="hangupCall()" style="margin-top:20px;background:#e74c3c;padding:10px 20px;">Hang up</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>
<script src="script.js"></script>

<script>
function showTab(tab) {
  ["products","orders","sales","settings","chat"].forEach(t => {
    document.getElementById("tab-"+t).style.display = (t===tab) ? "block" : "none";
  });
}
</script>

</body>
</html>.container { display:flex; height:calc(100vh - 60px); }
nav.sidebar {
  width:220px;
  background:#111;
  padding:16px;
  display:flex;
  flex-direction:column;
  box-shadow:2px 0 6px rgba(0,0,0,0.5);
}
nav.sidebar button {
  background:none;
  border:none;
  color:#eee;
  text-align:left;
  padding:12px;
  margin-bottom:8px;
  border-radius:6px;
  font-size:1rem;
  transition:0.2s;
}
nav.sidebar button.active,
nav.sidebar button:hover {
  background:#3498db;
  color:#fff;
}
main.content { flex:1; padding:24px; overflow-y:auto; }

/* ---------------- Cards ---------------- */
.card {
  background:#111;
  padding:16px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.5);
  margin-bottom:24px;
}

/* ---------------- Chat Enhancements ---------------- */
.user-btn {
  display:flex;
  gap:10px;
  align-items:center;
  padding:10px;
  background:#111;
  border-radius:8px;
  border:1px solid #1b1b1b;
  color:#eee;
  cursor:pointer;
}
.user-btn:hover { background:#17202a; transform:translateY(-1px); }

.user-avatar {
  width:44px;height:44px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-weight:700;color:#fff;background:#3498db;
}

.user-meta { display:flex; flex-direction:column; min-width:0; }
.user-name { font-weight:700; color:#fff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:170px; }
.user-last { font-size:0.85rem; color:#9b9b9b; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:170px; }
.user-badge { margin-left:auto; background:#e74c3c; color:#fff; font-size:0.8rem; padding:4px 8px; border-radius:999px; }

/* Messages */
.bubble-admin { align-self:flex-end; background:#3498db; color:#fff; padding:8px 12px; border-radius:12px; max-width:75%; }
.bubble-customer { align-self:flex-start; background:#1f2226; color:#fff; padding:8px 12px; border-radius:12px; max-width:75%; }
.msg-time { font-size:0.75rem; color:#9b9b9b; margin-top:4px; align-self:flex-end; }

/* Call UI */
#call-panel {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.75);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:2000;
}
#call-panel-inner {
  background:#111;
  padding:20px;
  border-radius:12px;
  text-align:center;
  max-width:380px;
}

</style>
</head>
<body>
  <header>
  <div class="brand">CobainTech Admin</div>

  <div class="header-actions" style="display:flex;align-items:center;gap:10px;">
    <span id="welcome-user-top" style="margin-right:10px;"></span>

    <button onclick="window.open('index.html','_blank')" class="btn-store">üè¨ Store</button>

    <button onclick="logoutUser()" class="btn-logout">üîí Logout</button>
  </div>
</header>

<div class="container">
  <nav class="sidebar">
    <button class="active" onclick="showTab('products')">Products</button>
    <button onclick="showTab('orders')">Orders</button>
    <button onclick="showTab('sales')">Sales</button>
    <button onclick="showTab('settings')">Settings</button>

    <!-- Chat tab badge enabled -->
    <button onclick="showTab('chat')" style="display:flex;justify-content:space-between;align-items:center;">
      Chat
      <span id="chat-tab-badge" style="display:none;background:#e74c3c;color:#fff;padding:3px 8px;border-radius:10px;font-size:0.75rem;"></span>
    </button>
  </nav>

  <main class="content">

    <!-- ========================= PRODUCTS ========================= -->
    <section id="tab-products">
      <div class="card">
        <button onclick="showAddProduct()" class="btn primary">Add Product</button>

        <div id="product-form-area" style="display:none;">
          <h3 id="product-form-title">Add Product</h3>
          <form id="product-form" onsubmit="saveProduct(event)">
            <input type="hidden" id="p-id">

            <label>Title <input id="p-title" required></label>
            <label>Price <input type="number" id="p-price" required></label>
            <label>Stock <input type="number" id="p-stock" required></label>
            <label>Category <input id="p-category" required></label>
            <label>Description <input id="p-desc"></label>
            <label>Image URL <input id="p-image-url" placeholder="https://example.com/image.jpg"></label>

            <div style="display:flex;gap:8px;">
              <button type="submit" class="btn primary">Save</button>
              <button type="button" class="btn ghost" onclick="hideProductForm()">Cancel</button>
            </div>
          </form>
        </div>
      </div>

      <input id="admin-search" placeholder="Search products..." oninput="renderAdminProducts()">
      <div id="admin-product-list" class="product-grid"></div>
    </section>


    <!-- ========================= CHAT (UPGRADED) ========================= -->
    <section id="tab-chat" style="display:none;">
      <div class="card" style="padding:14px; display:flex; flex-direction:column; height:600px;">

        <!-- Header -->
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
          <h3>Customer Messages</h3>

          <input id="chat-search" placeholder="Search..." 
            style="padding:8px 10px;border-radius:8px;border:1px solid #333;background:#0b0c0e;color:#eee;">
        </div>

        <!-- Layout -->
        <div style="display:flex;gap:12px;flex:1;min-height:0;overflow:hidden;">

          <!-- User List -->
          <div id="chat-users" 
            style="width:300px;background:#0f1113;border-radius:12px;padding:8px;overflow-y:auto;display:flex;flex-direction:column;gap:8px;">
            <div style="padding:12px;color:#999">Loading users‚Ä¶</div>
          </div>

          <!-- Chat Panel -->
          <div style="flex:1;display:flex;flex-direction:column;min-width:0;gap:10px;">

            <!-- Chat Header -->
            <div id="chat-panel-header" 
              style="background:#0f1113;padding:12px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;">
              
              <div style="display:flex;gap:12px;align-items:center;">
                <div id="chat-avatar"
                  style="width:48px;height:48px;border-radius:50%;background:#3498db;color:#fff;
                  display:flex;align-items:center;justify-content:center;font-weight:700;">U</div>

                <div>
                  <div id="chat-with" style="font-weight:700;">Select a customer</div>
                  <div id="chat-last-seen" style="font-size:0.8rem;color:#a5a5a5;">‚Äî</div>
                </div>
              </div>

              <div style="display:flex;gap:8px;">
                <button id="btn-call" onclick="startCallAsAdmin()" class="btn small">üìû Call</button>
                <button id="btn-hangup" onclick="hangupCall()" class="btn small"
                  style="display:none;background:#e74c3c;color:#fff;">Hang up</button>
              </div>
            </div>

            <!-- Messages -->
            <div id="chat-admin-messages"
              style="flex:1;background:#070708;border-radius:8px;padding:12px;overflow-y:auto;display:flex;flex-direction:column;gap:8px;">
              <div style="color:#9b9b9b">Open a chat to view messages.</div>
            </div>

            <!-- Typing indicator -->
            <div id="chat-typing" style="min-height:18px;color:#9b9b9b;font-size:0.9rem;"></div>

            <!-- Message input -->
            <div style="display:flex;gap:8px;">
              <input id="admin-chat-input" placeholder="Type a message..."
                style="flex:1;padding:10px 12px;border-radius:20px;border:1px solid #333;background:#0b0c0e;color:#eee;">
              <button class="btn primary" onclick="adminSendChat()">Send</button>
            </div>

            <!-- Quick Replies -->
            <div style="display:flex;gap:8px;margin-top:6px;">
              <button class="btn ghost" onclick="insertQuickReply('Hello! How can I help you?')">Hello</button>
              <button class="btn ghost" onclick="insertQuickReply('Your order is being processed.')">Order Update</button>
              <button class="btn ghost" onclick="insertQuickReply('Can you send a photo of the issue?')">Send Photo</button>
            </div>

          </div>
        </div>
      </div>
    </section>


    <!-- ========================= ORDERS ========================= -->
    <section id="tab-orders" style="display:none;">
      <div class="card">
        <h3>Orders</h3>
        <table>
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Items</th>
              <th>Total</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="admin-orders"></tbody>
        </table>
      </div>
    </section>

    <!-- ========================= SALES ========================= -->
    <section id="tab-sales" style="display:none;">
      <div class="card">
        <h3>Sales Overview</h3>
        <div class="sales-metrics">
          <div class="metric"><h3>Total Revenue</h3><p id="total-revenue">‚Ç±0</p></div>
          <div class="metric"><h3>Total Orders</h3><p id="total-orders">0</p></div>
        </div>
        <canvas id="salesChart" height="250"></canvas>
      </div>
    </section>

    <!-- ========================= SETTINGS ========================= -->
    <section id="tab-settings" style="display:none;">
      <div class="card">
        <h3>Store Settings</h3>

        <form id="settings-form" onsubmit="saveSettings(event)">
          <label>Store Name <input id="store-name" placeholder="CobainTech"></label>
          <label>Logo URL <input id="store-logo" placeholder="https://example.com/logo.png"></label>
          <label>Email <input id="store-email"></label>
          <label>Phone <input id="store-phone"></label>
          <button class="btn primary" type="submit">Save</button>
        </form>
      </div>
    </section>

  </main>
</div>


<!-- ========================= CALL PANEL ========================= -->
<div id="call-panel">
  <div id="call-panel-inner">
    <h2 id="call-status">Incoming call‚Ä¶</h2>

    <video id="localVideo" autoplay playsinline muted style="width:100%;border-radius:12px;margin:10px 0;"></video>
    <video id="remoteVideo" autoplay playsinline style="width:100%;border-radius:12px;margin:10px 0;"></video>

    <div style="display:flex;gap:12px;justify-content:center;margin-top:12px;">
      <button id="answerBtn" onclick="acceptCall()" class="btn primary">Answer</button>
      <button id="declineBtn" onclick="rejectCall()" class="btn ghost">Decline</button>
      <button id="hangupBtn" onclick="hangupCall()" class="btn ghost" style="display:none;">Hang Up</button>
    </div>
  </div>
</div>


<!-- Firebase & Scripts -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script src="firebase-config.js"></script>
<script src="script.js"></script>

</body>
</html>

