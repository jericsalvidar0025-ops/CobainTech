<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin Dashboard ‚Äî CobainTech</title>
<link rel="stylesheet" href="style.css">
<style>
/* ---------------- Global ---------------- */
body { margin:0; font-family:'Segoe UI',Roboto,sans-serif; background:#0b0c0e; color:#eee; }
a { color:inherit; text-decoration:none; }
h1,h2,h3,h4,h5,h6 { margin:0; }
button { cursor:pointer; }

/* ---------------- Header ---------------- */
header { background:#111; padding:12px 24px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 6px rgba(0,0,0,0.5);}
.brand { font-weight:bold; font-size:1.5rem; color:#fff; }
.header-actions button { background:#3498db; border:none; color:#fff; padding:8px 16px; border-radius:6px; transition:0.2s; }
.header-actions button:hover { background:#2980b9; }

/* ---------------- Layout ---------------- */
.container { display:flex; height:calc(100vh - 60px); }
nav.sidebar { width:220px; background:#111; padding:16px; display:flex; flex-direction:column; box-shadow:2px 0 6px rgba(0,0,0,0.5); }
nav.sidebar button { background:none; border:none; color:#eee; text-align:left; padding:12px; margin-bottom:8px; border-radius:6px; font-size:1rem; transition:0.2s; }
nav.sidebar button.active, nav.sidebar button:hover { background:#3498db; color:#fff; }
main.content { flex:1; padding:24px; overflow-y:auto; }

/* ---------------- Cards & Tables ---------------- */
.card { background:#111; padding:16px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.5); margin-bottom:24px; }
table { width:100%; border-collapse:collapse; margin-top:12px; }
th, td { padding:12px; text-align:left; }
th { background:#222; font-weight:600; }
tr:nth-child(even) { background:#1a1a1a; }
tr:hover { background:#2c3e50; }
button.small { padding:6px 12px; border-radius:6px; font-size:.85rem; }

/* ---------------- Inputs ---------------- */
input, select { background:#1a1a1a; color:#eee; border:1px solid #444; border-radius:6px; padding:6px 10px; width:100%; margin-bottom:12px; }
label { display:block; margin-bottom:6px; font-weight:600; }

/* ---------------- Modals ---------------- */
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000; }
.modal-inner { background:#111; padding:24px; border-radius:12px; max-width:600px; width:90%; box-shadow:0 6px 20px rgba(0,0,0,0.5); }
.modal-inner button.close { float:right; background:#e74c3c; color:#fff; border:none; padding:6px 12px; border-radius:6px; }

/* ---------------- Product Form ---------------- */
#product-form-area { display:none; margin-bottom:24px; }

/* ---------------- Products Grid ---------------- */
.product-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:16px; margin-top:16px; }
.product-card { background:#1a1a1a; border-radius:12px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.5); display:flex; flex-direction:column; }
.product-card img { width:100%; height:150px; object-fit:cover; }
.product-card .product-info { padding:12px; flex:1; display:flex; flex-direction:column; }
.product-card h4 { margin-bottom:8px; font-size:1rem; }
.product-card p { font-size:.9rem; margin-bottom:4px; }
.product-card .actions { margin-top:auto; display:flex; gap:6px; }

/* ---------------- Sales ---------------- */
.sales-metrics { display:flex; gap:16px; margin-bottom:24px; flex-wrap:wrap; }
.metric { flex:1; min-width:150px; background:#111; padding:16px; border-radius:12px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.5); }
.metric h3 { font-size:1.2rem; margin-bottom:8px; }
.metric p { font-size:1.5rem; font-weight:bold; color:#3498db; }
</style>
</head>
<body>

<header>
  <div class="brand">CobainTech Admin</div>
  <div class="header-actions" style="display:flex;align-items:center;gap:10px;">
    <span id="welcome-user-top" style="margin-right:10px;"></span>

    <!-- Store Button -->
    <button onclick="window.open('index.html','_blank')" class="btn-store">
      üè¨ Store
    </button>

    <!-- Logout Button -->
    <button onclick="logoutUser()" class="btn-logout">
      üîí Logout
    </button>
  </div>
</header>

<style>
.btn-store, .btn-logout {
  background: #3498db;
  border: none;
  color: #fff;
  padding: 8px 16px;
  border-radius: 6px;
  font-weight: 500;
  transition: background 0.2s;
}
.btn-store:hover { background: #2980b9; }
.btn-logout {
  background: #e74c3c;
}
.btn-logout:hover {
  background: #c0392b;
}
</style>

<script>
// Wait until Firebase is fully loaded
window.addEventListener('load', () => {
  // Redefine logout function after Firebase initializes
  window.logoutUser = function() {
    if (firebase && firebase.auth) {
      firebase.auth().signOut()
        .then(() => {
          console.log('User signed out successfully.');
          window.location.href = "index.html"; // redirect to store main page
        })
        .catch((error) => {
          console.error("Logout failed:", error);
          alert("Logout failed. Check console for details.");
        });
    } else {
      console.error("Firebase not loaded yet.");
      alert("Please wait a few seconds and try again.");
    }
  };
});
</script>


<div class="container">
  <nav class="sidebar">
    <button class="active" onclick="showTab('products')">Products</button>
    <button onclick="showTab('orders')">Orders</button>
    <button onclick="showTab('sales')">Sales</button>
    <button onclick="showTab('settings')">Settings</button>
  </nav>

  <main class="content">
    <!-- Products Tab -->
    <section id="tab-products">
      <div class="card">
        <button onclick="showAddProduct()" class="btn primary">Add Product</button>
        <div id="product-form-area">
          <h3 id="product-form-title">Add Product</h3>
          <form id="product-form" onsubmit="saveProduct(event)">
            <input type="hidden" id="p-id">
            <label>Title <input id="p-title" required></label>
            <label>Price <input type="number" id="p-price" required></label>
            <label>Stock <input type="number" id="p-stock" required></label>
            <label>Category <input id="p-category" required></label>
            <label>Description <input id="p-desc"></label>
            <label>Image URL <input id="p-image-url" placeholder="https://example.com/image.jpg"></label>
            <div style="display:flex;gap:8px;">
              <button type="submit" class="btn primary">Save</button>
              <button type="button" class="btn ghost" onclick="hideProductForm()">Cancel</button>
            </div>
          </form>
        </div>
      </div>
      <input id="admin-search" placeholder="Search products..." oninput="renderAdminProducts()">
      <div id="admin-product-list" class="product-grid"></div>
    </section>

    <!-- Orders Tab -->
    <section id="tab-orders" style="display:none">
      <div class="card">
        <h3>Orders</h3>
        <table>
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Items</th>
              <th>Total</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="admin-orders"></tbody>
        </table>
      </div>
    </section>

    <!-- Sales Tab -->
    <section id="tab-sales" style="display:none">
      <div class="card">
        <h3>Sales Overview</h3>
        <div class="sales-metrics">
          <div class="metric">
            <h3>Total Revenue</h3>
            <p id="total-revenue">‚Ç±0</p>
          </div>
          <div class="metric">
            <h3>Total Orders</h3>
            <p id="total-orders">0</p>
          </div>
        </div>
        <canvas id="salesChart" height="250"></canvas>
      </div>
    </section>
<!-- Settings Tab -->
<section id="tab-settings" style="display:none">
  <div class="card">
    <h3>Store Settings</h3>
    <form id="settings-form" onsubmit="saveSettings(event)">
      <label>Store Name
        <input id="store-name" placeholder="CobainTech">
      </label>
      <label>Store Logo URL
        <input id="store-logo" placeholder="https://example.com/logo.png">
      </label>
      <label>Contact Email
        <input id="store-email" placeholder="support@cobaintech.com">
      </label>
      <label>Contact Phone
        <input id="store-phone" placeholder="+63 900 000 0000">
      </label>
      <button type="submit" class="btn primary">Save Settings</button>
    </form>
  </div>
</section>
  </main>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>
<script src="script.js"></script>

<script>
function showTab(tab){
  ['products','orders','sales'].forEach(t=>{
    document.getElementById('tab-'+t).style.display=(t===tab)?'block':'none';
    document.querySelectorAll('.sidebar button').forEach(btn=>{
      if(btn.textContent.toLowerCase()===t) btn.classList.toggle('active', t===tab);
    });
  });
}

// Products rendering with Firestore imgUrl
function renderAdminProducts(){
  const container = document.getElementById('admin-product-list');
  db.collection('products').orderBy('createdAt','desc').get().then(snapshot=>{
    const products=[];
    snapshot.forEach(doc=>{
      const p = doc.data();
      p.id = doc.id;
      const searchValue = (document.getElementById('admin-search').value||'').toLowerCase();
      if(!searchValue || p.title.toLowerCase().includes(searchValue) || (p.category||'').toLowerCase().includes(searchValue)){
        products.push(p);
      }
    });

    container.innerHTML = products.map(p=>`
      <div class="product-card">
        <img src="${p.imgUrl||'https://via.placeholder.com/150'}" alt="${p.title}">
        <div class="product-info">
          <h4>${p.title}</h4>
          <p>‚Ç±${p.price.toLocaleString()}</p>
          <p>Stock: ${p.stock||0}</p>
          <p>Category: ${p.category||''}</p>
          <div class="actions">
            <button class="btn small primary" onclick="editProduct('${p.id}')">Edit</button>
            <button class="btn small ghost" onclick="deleteProduct('${p.id}')">Delete</button>
          </div>
        </div>
      </div>
    `).join('');
  });
}

// Sales chart
let salesChart;
function renderSalesChart(){
  const ctx = document.getElementById('salesChart').getContext('2d');
  db.collection('orders').orderBy('createdAt').get().then(snapshot=>{
    const labels = [], data = [];
    snapshot.forEach(doc=>{
      const o = doc.data();
      const date = o.createdAt?.toDate().toLocaleDateString() || '';
      labels.push(date);
      data.push(o.total||0);
    });
    if(salesChart) salesChart.destroy();
    salesChart = new Chart(ctx,{
      type:'line',
      data:{labels, datasets:[{label:'Order Total', data, borderColor:'#3498db', backgroundColor:'rgba(52,152,219,0.2)'}]},
      options:{responsive:true, plugins:{legend:{display:false}}}
    });
  });
}

// Load admin dashboard
window.addEventListener('load',()=>{
  bindAuthState();
  initAdmin();
  initAdminOrders();
  renderAdminProducts();
  renderSalesChart();

  // Sales metrics
  ordersRef().onSnapshot(snapshot=>{
    let totalRevenue=0;
    snapshot.forEach(doc=>{ totalRevenue+=doc.data().total||0; });
    document.getElementById('total-revenue').textContent='‚Ç±'+totalRevenue.toLocaleString();
    document.getElementById('total-orders').textContent=snapshot.size;
  });
});
</script>
<script>
// ---------- SETTINGS ----------
function loadSettings() {
  db.collection('settings').doc('store').get().then(doc => {
    if (doc.exists) {
      const s = doc.data();
      document.getElementById('store-name').value = s.name || '';
      document.getElementById('store-logo').value = s.logo || '';
      document.getElementById('store-email').value = s.email || '';
      document.getElementById('store-phone').value = s.phone || '';
    }
  }).catch(err => console.error('Error loading settings:', err));
}

function saveSettings(e) {
  e.preventDefault();
  const name = document.getElementById('store-name').value;
  const logo = document.getElementById('store-logo').value;
  const email = document.getElementById('store-email').value;
  const phone = document.getElementById('store-phone').value;

  db.collection('settings').doc('store').set({
    name, logo, email, phone, updatedAt: new Date()
  }).then(() => {
    alert('Settings saved successfully!');
  }).catch(err => {
    console.error('Error saving settings:', err);
    alert('Failed to save settings.');
  });
}

// Auto-load when Settings tab is opened
function showTab(tab){
  ['products','orders','sales','settings'].forEach(t=>{
    document.getElementById('tab-'+t).style.display=(t===tab)?'block':'none';
    document.querySelectorAll('.sidebar button').forEach(btn=>{
      if(btn.textContent.toLowerCase()===t)
        btn.classList.toggle('active', t===tab);
    });
  });

  if(tab==='settings') loadSettings();
}
</script>
</body>
</html>




