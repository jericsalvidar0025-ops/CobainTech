<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Dashboard — CobainTech</title>
<link rel="stylesheet" href="style.css">
<style>
  body { background:#121212; color:#eee; font-family: 'Segoe UI', sans-serif; margin:0; }
  header { background:#1F1F1F; padding:16px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 6px rgba(0,0,0,0.5); }
  header a { color:#fff; text-decoration:none; font-weight:600; margin-right:16px; }
  h1,h2,h3 { margin:0 0 12px 0; }
  table { width:100%; border-collapse:collapse; margin-top:16px; }
  th, td { padding:12px; text-align:left; border-bottom:1px solid #333; }
  th { background:#1F1F1F; }
  tr:hover { background:#222; }
  button { cursor:pointer; border:none; border-radius:6px; padding:6px 12px; font-weight:600; }
  .btn.primary { background:#3498db; color:#fff; }
  .btn.ghost { background:#333; color:#eee; }
  #product-form input, #product-form select { background:#222; color:#eee; border:none; border-radius:6px; padding:8px; width:100%; margin-bottom:12px; }
  #products-section { padding:24px; max-width:1000px; margin:auto; }
  img.product-thumb { width:60px; height:60px; object-fit:cover; border-radius:6px; }
</style>
</head>
<body>

<header>
  <h1>Admin Dashboard</h1>
  <nav>
    <a href="index.html">Store</a>
    <span id="welcome-user-top"></span>
    <button onclick="logoutUser()" class="btn ghost">Logout</button>
  </nav>
</header>

<main>
  <div id="products-section">
    <h2>Products Management</h2>

    <!-- Add / Update Product Form -->
    <div style="margin-bottom:24px; background:#1F1F1F; padding:16px; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,0.3);">
      <h3 id="form-title">Add New Product</h3>
      <form id="product-form">
        <input id="prod-title" placeholder="Product Title" required>
        <input type="number" id="prod-price" placeholder="Price" required>
        <input id="prod-category" placeholder="Category" required>
        <input id="prod-image" type="url" placeholder="Image URL (https://example.com/image.jpg)" required>
        <div style="margin-top:12px;">
          <button type="submit" class="btn primary">Save Product</button>
          <button type="button" class="btn ghost" onclick="resetProductForm()">Cancel</button>
        </div>
      </form>
    </div>

    <!-- Products Table -->
    <table>
      <thead>
        <tr>
          <th>Image</th>
          <th>Title</th>
          <th>Price</th>
          <th>Category</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="admin-products"></tbody>
    </table>
  </div>
</main>

<footer style="text-align:center; padding:16px; color:#aaa; background:#1F1F1F;">© <span id="year"></span> CobainTech</footer>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script src="firebase-config.js"></script>
<script src="script.js"></script>

<script>
// Set footer year
document.getElementById('year').textContent = new Date().getFullYear();

// Admin Dashboard JS
let editingProductId = null;

// Load products
async function loadProducts() {
  const snapshot = await db.collection('products').orderBy('createdAt','desc').get();
  const tbody = document.getElementById('admin-products');
  tbody.innerHTML = snapshot.docs.map(doc => {
    const p = doc.data();
    return `<tr>
      <td><img src="${p.image}" alt="${p.title}" class="product-thumb"></td>
      <td>${p.title}</td>
      <td>₱${(p.price||0).toLocaleString()}</td>
      <td>${p.category}</td>
      <td>
        <button class="btn ghost" onclick="editProduct('${doc.id}')">Edit</button>
        <button class="btn ghost" style="background:red;color:#fff;" onclick="deleteProduct('${doc.id}')">Delete</button>
      </td>
    </tr>`;
  }).join('');
}

// Add / Update product
document.getElementById('product-form').addEventListener('submit', async e => {
  e.preventDefault();
  const title = document.getElementById('prod-title').value.trim();
  const price = parseFloat(document.getElementById('prod-price').value);
  const category = document.getElementById('prod-category').value.trim();
  const image = document.getElementById('prod-image').value.trim();

  if(editingProductId){
    // Update
    await db.collection('products').doc(editingProductId).update({ title, price, category, image });
    editingProductId = null;
  } else {
    // Add
    await db.collection('products').add({ title, price, category, image, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
  }
  resetProductForm();
  loadProducts();
});

// Edit product
function editProduct(id){
  editingProductId = id;
  db.collection('products').doc(id).get().then(doc=>{
    const p = doc.data();
    document.getElementById('prod-title').value = p.title;
    document.getElementById('prod-price').value = p.price;
    document.getElementById('prod-category').value = p.category;
    document.getElementById('prod-image').value = p.image;
    document.getElementById('form-title').textContent = 'Edit Product';
  });
}

// Delete product
function deleteProduct(id){
  if(confirm('Are you sure you want to delete this product?')){
    db.collection('products').doc(id).delete().then(loadProducts);
  }
}

// Reset form
function resetProductForm(){
  editingProductId = null;
  document.getElementById('product-form').reset();
  document.getElementById('form-title').textContent = 'Add New Product';
}

// Show admin products section after auth check
auth.onAuthStateChanged(user=>{
  if(!user){
    alert('Please login as admin');
    window.location.href = 'login.html';
  } else {
    // Optionally check role from users collection
    loadProducts();
  }
});
</script>
</body>
</html>
